<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metrica">
<title>Regression case: Assessing model agreement in wheat grain nitrogen content prediction • metrica</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Ubuntu-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regression case: Assessing model agreement in wheat grain nitrogen content prediction">
<meta property="og:description" content="metrica">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metrica</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.999</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/apsim_open.html">APSIM: Importing APSIM Classic and NewGeneration files</a>
    <a class="dropdown-item" href="../articles/available_metrics_classification.html">Classification performance metrics and indices</a>
    <a class="dropdown-item" href="../articles/available_metrics_regression.html">Regression performance metrics and indices</a>
    <a class="dropdown-item" href="../articles/classification_case.html">Classification case: Assessing the performance of remote sensing models</a>
    <a class="dropdown-item" href="../articles/regression_case.html">Regression case: Assessing model agreement in wheat grain nitrogen content prediction</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/adriancorrendo/metrica/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="regression_case_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Regression case: Assessing model agreement in wheat grain nitrogen content prediction</h1>
                        <h4 data-toc-skip class="author">Leo Bastos &amp; Adrian Correndo</h4>
            
            <h4 data-toc-skip class="date">2022-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adriancorrendo/metrica/blob/HEAD/vignettes/regression_case.Rmd" class="external-link"><code>vignettes/regression_case.Rmd</code></a></small>
      <div class="d-none name"><code>regression_case.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><img src="../reference/figures/metrica_logo.png" align="right" height="150" style="float:right; height:150px;"><br> The <em><code>metrica</code></em> package was developed to visualize and compute the level of agreement between observed ground-truth values and model-derived (e.g., mechanistic or empirical) predictions.</p>
<p>This package is intended to fit into the following workflow:</p>
<ol style="list-style-type: decimal">
<li>a data set containing the observed values is used to train a model<br>
</li>
<li>the trained model is used to generate predictions<br>
</li>
<li>a data frame containing at least the <strong>observed</strong> and model-<strong>predicted</strong> values is created<br>
</li>
<li>
<em><code>metrica</code></em> package is used to compute goodness of fit and error metrics based on observed and predicted values<br>
</li>
<li>
<em><code>metrica</code></em> package is used to visualize model fit and selected fit metrics</li>
</ol>
<p>This vignette introduces the functionality of the <em><code>metrica</code></em> package applied to observed and model-predicted values of wheat grain nitrogen (N) content (in grams of N <span class="math inline">\(m^{-2}\)</span>).</p>
</div>
<div class="section level2">
<h2 id="wheat-grain-n-content">2. Wheat grain N content<a class="anchor" aria-label="anchor" href="#wheat-grain-n-content"></a>
</h2>
<p>Let’s begin by loading the packages needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adriancorrendo.github.io/metrica/">metrica</a></span><span class="op">)</span></span></code></pre></div>
<p>Now we load the <code>wheat</code> data set included in the <code>metrica</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wheat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing first observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wheat</span><span class="op">)</span></span>
<span><span class="co">#&gt;        pred    obs</span></span>
<span><span class="co">#&gt; 1  2.577314  2.544</span></span>
<span><span class="co">#&gt; 2  3.989590  4.831</span></span>
<span><span class="co">#&gt; 3  5.645253  6.121</span></span>
<span><span class="co">#&gt; 4 13.125101 10.960</span></span>
<span><span class="co">#&gt; 5  4.955917  5.767</span></span>
<span><span class="co">#&gt; 6  6.687800  8.222</span></span></code></pre></div>
<p>This data set contains two columns:</p>
<ul>
<li>
<strong>pred</strong>: model-predicted wheat grain N content, in g N <span class="math inline">\(m^{-2}\)</span>,<br>
</li>
<li>
<strong>obs</strong>: ground-truth observed wheat grain N content, in g N <span class="math inline">\(m^{-2}\)</span>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="visual-assessment-of-agreement">3. Visual assessment of agreement<a class="anchor" aria-label="anchor" href="#visual-assessment-of-agreement"></a>
</h2>
<div class="section level3">
<h3 id="scatterplot-of-pred-vs--obs">3.1 Scatterplot of pred vs. obs<a class="anchor" aria-label="anchor" href="#scatterplot-of-pred-vs--obs"></a>
</h3>
<p>The simplest way to visually assess agreement between observed and predicted values is with a scatterplot.</p>
<p>We can use the function <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code> from the <em>metrica</em> package to create a scatterplot.</p>
<p>The function requires specifying at least:</p>
<ul>
<li>the data frame object name (<code>data</code> argument)</li>
<li>the name of the column containing observed values (<code>obs</code> argument)<br>
</li>
<li>the name of the column containing predicted values (<code>pred</code> argument)</li>
</ul>
<p>Besides a scatterplot, this function also adds to the plot the <strong>1:1 line</strong> (solid line) and the <strong>linear regression line</strong> (dashed line).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>, </span>
<span>             obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>             pred <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot%20PO-1.png" width="1000"></p>
<p>The default behavior of <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code> places the <code>obs</code> column on the x axis and the <code>pred</code> column on the y axis (<code>orientation = "PO"</code>). This can be inverted by changing the argument <code>orientation</code> to “OP”:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>, </span>
<span>             obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>             pred <span class="op">=</span> <span class="va">pred</span>,</span>
<span>             orientation <span class="op">=</span> <span class="st">"OP"</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot%20OP-1.png" width="1000"></p>
<p>The output of the <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code> function is a <code>ggplot2</code> object that can be further customized:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>, </span>
<span>             obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>             pred <span class="op">=</span> <span class="va">pred</span>,</span>
<span>             orientation <span class="op">=</span> <span class="st">"OP"</span>,</span>
<span>             regline_color <span class="op">=</span> <span class="st">"#d0f4de"</span>,</span>
<span>             shape_color <span class="op">=</span> <span class="st">"#80ed99"</span>,</span>
<span>             eq_color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>             <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span><span class="st">"Predicted wheat N content (g N/m2)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Observed wheat N content (g N/m2)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_dark</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot%20custom-1.png" width="1000"></p>
</div>
</div>
<div class="section level2">
<h2 id="bland-altman-plot">3.2 Bland-Altman plot<a class="anchor" aria-label="anchor" href="#bland-altman-plot"></a>
</h2>
<p>The Bland-Altman plot is another way of visually assessing observed vs. predicted agreement. It plots the difference between observed and predicted values on the y axis, and the observed values on the x axis:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bland_altman_plot.html">bland_altman_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>                  obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                  pred <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/bland-altman-1.png" width="1000"></p>
</div>
<div class="section level2">
<h2 id="numerical-assessment-of-agreement">4. Numerical assessment of agreement<a class="anchor" aria-label="anchor" href="#numerical-assessment-of-agreement"></a>
</h2>
<p>The <em>metrica</em> package contains functions for <strong>41 metrics</strong> to assess agreement between observed and predicted values for continuous data (i.e., regression error).</p>
<p>A list with all the the metrics including their name, definition, details, formula, and function name, please check [here].</p>
<p>All of the metric functions take the same three arguments as the plotting functions:</p>
<ul>
<li>the data frame object name (<code>data</code> argument)</li>
<li>the name of the column containing observed values (<code>obs</code> argument)<br>
</li>
<li>the name of the column containing predicted values (<code>pred</code> argument)</li>
</ul>
<p>The user can choose to calculate a single metric, or to calculate all metrics at once.</p>
<p>To calculate a single metric, the metric function can be called.<br>
For example, to calculate <span class="math inline">\(R^{2}\)</span>, we can use the <code><a href="../reference/R2.html">R2()</a></code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/R2.html">R2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>   obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>   pred <span class="op">=</span> <span class="va">pred</span>, tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          R2</span></span>
<span><span class="co">#&gt; 1 0.8455538</span></span></code></pre></div>
<p>Similarly, to calculate root mean squared error, we can use the <code><a href="../reference/RMSE.html">RMSE()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/RMSE.html">RMSE</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>, </span>
<span>     obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>     pred <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; $RMSE</span></span>
<span><span class="co">#&gt; [1] 1.666441</span></span></code></pre></div>
<p>The user can also calculate all 41 metrics at once using the function <code><a href="../reference/metrics_summary.html">metrics_summary()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metrics_summary.html">metrics_summary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>                obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                pred <span class="op">=</span> <span class="va">pred</span>, </span>
<span>                type <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Metric       Score</span></span>
<span><span class="co">#&gt; 1      B0  0.11315564</span></span>
<span><span class="co">#&gt; 2      B1  0.95057797</span></span>
<span><span class="co">#&gt; 3       r  0.91953997</span></span>
<span><span class="co">#&gt; 4      R2  0.84555376</span></span>
<span><span class="co">#&gt; 5      Xa  0.99564191</span></span>
<span><span class="co">#&gt; 6     CCC  0.91553253</span></span>
<span><span class="co">#&gt; 7     MAE  1.32781184</span></span>
<span><span class="co">#&gt; 8    RMAE  0.15214665</span></span>
<span><span class="co">#&gt; 9    MAPE 17.51424366</span></span>
<span><span class="co">#&gt; 10  SMAPE 17.43518492</span></span>
<span><span class="co">#&gt; 11    RAE  0.37156585</span></span>
<span><span class="co">#&gt; 12    RSE  0.16128874</span></span>
<span><span class="co">#&gt; 13    MBE  0.31815953</span></span>
<span><span class="co">#&gt; 14    PBE  3.64561486</span></span>
<span><span class="co">#&gt; 15    PAB  3.64510277</span></span>
<span><span class="co">#&gt; 16    PPB  1.51438787</span></span>
<span><span class="co">#&gt; 17    MSE  2.77702701</span></span>
<span><span class="co">#&gt; 18   RMSE  1.66644142</span></span>
<span><span class="co">#&gt; 19  RRMSE  0.19094834</span></span>
<span><span class="co">#&gt; 20    RSR  0.09678632</span></span>
<span><span class="co">#&gt; 21 iqRMSE  0.25237725</span></span>
<span><span class="co">#&gt; 22    MLA  0.14328045</span></span>
<span><span class="co">#&gt; 23    MLP  2.63374656</span></span>
<span><span class="co">#&gt; 24   RMLA  0.14328045</span></span>
<span><span class="co">#&gt; 25   RMLP  2.63374656</span></span>
<span><span class="co">#&gt; 26     SB  0.10122549</span></span>
<span><span class="co">#&gt; 27   SDSD  0.04205496</span></span>
<span><span class="co">#&gt; 28    LCS  2.63374656</span></span>
<span><span class="co">#&gt; 29    PLA  5.15949064</span></span>
<span><span class="co">#&gt; 30    PLP 94.84050936</span></span>
<span><span class="co">#&gt; 31     Ue 94.84050936</span></span>
<span><span class="co">#&gt; 32     Uc  1.51438787</span></span>
<span><span class="co">#&gt; 33     Ub  3.64510277</span></span>
<span><span class="co">#&gt; 34    NSE  0.83871126</span></span>
<span><span class="co">#&gt; 35     E1  0.62843415</span></span>
<span><span class="co">#&gt; 36   Erel  0.77057561</span></span>
<span><span class="co">#&gt; 37    KGE  0.91064709</span></span>
<span><span class="co">#&gt; 38      d  0.95632264</span></span>
<span><span class="co">#&gt; 39     d1  0.80649196</span></span>
<span><span class="co">#&gt; 40    d1r  0.81421707</span></span>
<span><span class="co">#&gt; 41    RAC  0.95770115</span></span>
<span><span class="co">#&gt; 42     AC  0.84174217</span></span>
<span><span class="co">#&gt; 43 lambda  0.91553253</span></span>
<span><span class="co">#&gt; 44  dcorr  0.89747940</span></span>
<span><span class="co">#&gt; 45    MIC  0.78940412</span></span></code></pre></div>
<p>If the user wants just specific metrics, within the same function <code><a href="../reference/metrics_summary.html">metrics_summary()</a></code>, user can pass a list of desired metrics using the argument “metrics_list” as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my.metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R2"</span>,<span class="st">"MBE"</span>, <span class="st">"RMSE"</span>, <span class="st">"RSR"</span>, <span class="st">"NSE"</span>, <span class="st">"KGE"</span>, <span class="st">"CCC"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/metrics_summary.html">metrics_summary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,   </span>
<span>                obs <span class="op">=</span> <span class="va">obs</span>,    </span>
<span>                pred <span class="op">=</span> <span class="va">pred</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"regression"</span>,</span>
<span>                metrics_list <span class="op">=</span> <span class="va">my.metrics</span><span class="op">)</span> </span>
<span><span class="co">#&gt;   Metric      Score</span></span>
<span><span class="co">#&gt; 1     R2 0.84555376</span></span>
<span><span class="co">#&gt; 2    CCC 0.91553253</span></span>
<span><span class="co">#&gt; 3    MBE 0.31815953</span></span>
<span><span class="co">#&gt; 4   RMSE 1.66644142</span></span>
<span><span class="co">#&gt; 5    RSR 0.09678632</span></span>
<span><span class="co">#&gt; 6    NSE 0.83871126</span></span>
<span><span class="co">#&gt; 7    KGE 0.91064709</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="time-series">5. Time series <br><a class="anchor" aria-label="anchor" href="#time-series"></a>
</h2>
<div class="section level3">
<h3 id="example-of-timeseries-prediction">5.1. Example of timeseries prediction<a class="anchor" aria-label="anchor" href="#example-of-timeseries-prediction"></a>
</h3>
<p>In some cases, we may count with time-series predictions (e.g. cumulative values from daily simulations). For example, let’s say that we evaluate the production of drymass during the season. For this specific case, the Mean Absolute Scaled Error is a more solid metric compared to conventional RMSE or similar metrics. <br></p>
<p>Let’s suppose that we have predictions of wheat grain N over the years on the same location for a series of 20 years from 2001 to 2020. Thus, we may get a random sample from the wheat data set and assume they represent the time series of interest. Therefore, we create a new <code>time</code> variable called <code>Year</code> that will serve to sort the observations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">165</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wheat_time</span> <span class="op">&lt;-</span> <span class="fu">metrica</span><span class="fu">::</span><span class="va"><a href="../reference/wheat.html">wheat</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="va">.</span>, size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2001</span>,<span class="fl">2020</span>, by <span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">wheat_time</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span>, fill <span class="op">=</span> <span class="st">"Predicted"</span>, shape <span class="op">=</span> <span class="st">"Predicted"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">obs</span>, fill <span class="op">=</span> <span class="st">"Observed"</span>, shape <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span>, col <span class="op">=</span> <span class="st">"Predicted"</span>, linetype <span class="op">=</span> <span class="st">"Predicted"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">obs</span>, col <span class="op">=</span> <span class="st">"Observed"</span>, linetype <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dark red"</span>,<span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">24</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dark red"</span>,<span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Wheat Grain N (g/m2)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/metrics%20time-series-1.png" width="1200"></p>
</div>
<div class="section level3">
<h3 id="use-mase-for-timeseries">5.2. Use MASE for timeseries <br><a class="anchor" aria-label="anchor" href="#use-mase-for-timeseries"></a>
</h3>
<p>In the case of timeseries analysis, the Mean Absolute Scaled Error (MASE, Hyndman &amp; Koehler, 2006), a scaled error metric, is preferable over other classic metrics such as the RMSE. With <code>metrica</code>, we can use the function MASE. Please, be aware that MASE requires the <code>obs</code> and <code>pred</code> data along with a third column corresponding to the temporal variable that sorts the data (use the <code>time</code> argument to specify it). The default method to scale the MASE is the <code>naive</code> forecast (random-walk), which requires the user to define the size of the <code>naive_step</code>. Otherwise, an out-of-bag MAE can be specified with the <code>oob_mae</code> argument. <br></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># MASE estimate, with naive approach (random-walk, i.e. using observation of t-1 as prediction)</span></span>
<span><span class="fu">metrica</span><span class="fu">::</span><span class="fu"><a href="../reference/MASE.html">MASE</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat_time</span>, obs <span class="op">=</span> <span class="va">obs</span>, pred <span class="op">=</span> <span class="va">pred</span>, </span>
<span>              naive_step <span class="op">=</span> <span class="fl">1</span>, tidy <span class="op">=</span> <span class="cn">FALSE</span>, time <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $MASE</span></span>
<span><span class="co">#&gt; [1] 0.2444194</span></span>
<span></span>
<span><span class="fu">metrica</span><span class="fu">::</span><span class="fu"><a href="../reference/MASE.html">MASE</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat_time</span>, obs <span class="op">=</span> <span class="va">obs</span>, pred <span class="op">=</span> <span class="va">pred</span>, </span>
<span>              naive_step <span class="op">=</span> <span class="fl">1</span>, tidy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $MASE</span></span>
<span><span class="co">#&gt; [1] 0.2444194</span></span>
<span></span>
<span><span class="co"># MASE estimate, with mae coming from an independent training set.</span></span>
<span><span class="fu">metrica</span><span class="fu">::</span><span class="fu"><a href="../reference/MASE.html">MASE</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat_time</span>, obs <span class="op">=</span> <span class="va">obs</span>, pred <span class="op">=</span> <span class="va">pred</span>, </span>
<span>              naive_step <span class="op">=</span> <span class="fl">1</span>, tidy <span class="op">=</span> <span class="cn">FALSE</span>, time <span class="op">=</span> <span class="st">"Year"</span>, oob_mae <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; $MASE</span></span>
<span><span class="co">#&gt; [1] 0.2143599</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visual-and-numerical-assessment-combined">6. Visual and numerical assessment combined<a class="anchor" aria-label="anchor" href="#visual-and-numerical-assessment-combined"></a>
</h2>
<p>The user can also create a scatter plot that includes not only the <strong>predicted</strong> vs. <strong>observed</strong> points, <strong>1:1 line</strong>, and <strong>regression line</strong>, but also <strong>selected metrics and their values</strong> plus the <strong>SMA regression equation</strong>.</p>
<p>This is accomplished with the function <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>             obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>             pred <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot-1.png" width="1200"></p>
<p>To print the metrics on the <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code>, just use print.metrics. Warning: do not forget to specify your ‘metrics.list’:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my.metrica.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>                                obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                                pred <span class="op">=</span> <span class="va">pred</span>,</span>
<span>                                print_metrics <span class="op">=</span> <span class="cn">TRUE</span>, metrics_list <span class="op">=</span> <span class="va">my.metrics</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my.metrica.plot</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot%20print_metrics-1.png" width="1200"> Also, as a ggplot element, outputs are flexible of further edition:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my.metrica.plot</span> <span class="op">+</span></span>
<span>  <span class="co"># Modify labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Observed (days to emergence)"</span>, y <span class="op">=</span> <span class="st">"Predicted (days to emergence)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Modify theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot.edit-1.png" width="1200"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my.metrica.plot</span> <span class="op">+</span></span>
<span>  <span class="co"># Modify labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Observed (Mg/ha)"</span>, y <span class="op">=</span> <span class="st">"Predicted (Mg/ha)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Modify theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_dark</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="regression_case_files/figure-html/scatter_plot.edit-2.png" width="1200"></p>
</div>
<div class="section level2">
<h2 id="exporting">7. Exporting<a class="anchor" aria-label="anchor" href="#exporting"></a>
</h2>
<p>To export the metrics summary table, the user can simply write it to file with the function <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metrics_summary.html">metrics_summary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wheat</span>,</span>
<span>                obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                pred <span class="op">=</span> <span class="va">pred</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="st">"metrics_summary.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, to export a plot, the user can simply write it to file with the function <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">my.metrica.plot</span>,</span>
<span>       <span class="st">"scatter_metrics.png"</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">5</span>,</span>
<span>       height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adrian A. Correndo, Adrian A. Correndo, Luiz H. Moro Rosso, Rai Schwalbert, Carlos Hernandez, Leonardo M. Bastos, Luciana Nieto, Dean Holzworth, Ignacio A. Ciampitti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
